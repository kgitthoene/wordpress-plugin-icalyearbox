if(window.jQuery){if(typeof globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")]==="undefined"){globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")]=function(){var modals={};var data={};var post_state={};var abort={};var save={};var annotations={};function format_day(d){var year=d.substr(0,4);var month=parseInt(d.substr(4,2));var day=parseInt(d.substr(6,2));return day+"."+month+"."+year}return{modals:modals,data:data,post_state:post_state,abort:abort,save:save,annotations:annotations,format_day:format_day}}()}if(typeof globalThis[Symbol.for("yetanotherwpicalcalendar_storage")]==="undefined"){globalThis[Symbol.for("yetanotherwpicalcalendar_storage")]=function(){var defaults={debug:false,is_enabled:true,token:"yetanotherwpicalcalendar"};var resize_timeout=null;var AJAX={RUNNING:0,FAIL:1,DONE:2,FINAL:4};function is_empty(s=""){return!s||s.length===0}function is_null(v=null){return v==null}function resize(){try{html5tooltips.refresh()}catch(e){console.error("plugin:"+_g.defaults.token+":EXCEPTION: "+e)}}function _post(path,params,method="post"){const form=document.createElement("form");form.method=method;form.action=path;for(const key in params){if(params.hasOwnProperty(key)){const hiddenField=document.createElement("input");hiddenField.type="hidden";hiddenField.name=key;hiddenField.value=params[key];form.appendChild(hiddenField)}}document.body.appendChild(form);form.submit()}function post_cb(jqXHR,status,data={},error_thrown=""){console.log("[POST-CB] STATUS='"+status+"' DATA='"+JSON.stringify(data)+" ERROR-THROWN='"+error_thrown+"'")}function post_cb_success(data,status,jqXHR){post_cb(jqXHR,status,data)}function post_cb_error(jqXHR,status,error_thrown){post_cb(jqXHR,status,{},error_thrown)}function post(uri,object,cb_success=null,cb_error=null){jQuery(function($){return $.ajax({url:uri,data:object,method:"POST",success:is_null(cb_success)?post_cb_success:cb_success,error:is_null(cb_error)?post_cb_error:cb_error})})}function load_annotations(id_selector=""){var _ga=globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")];jQuery(function($){$(id_selector+".yetanotherwpicalcalendar-annotation").each(function(idx){let id=$(this).attr("id");if(is_empty(id)){$(this).html('<div style="border-left:4px solid red;">&nbsp;No ID for annotations given!</div>')}else{let obj={action:"yetanotherwpicalcalendar_get_annotations",id:id};$.ajax({url:"/wp-admin/admin-ajax.php",data:obj,method:"POST"}).done(function(data,status,jqXHR){var b_is_ok=false;if(status=="success"){let rc=data.status;b_is_ok=rc=="OK"}if(b_is_ok){let id=data.id;let a_an=data.annotations;$(this).html(data.doc);_ga.annotations[id]=a_an}}.bind(this)).fail(function(jqXHR,status,error_thrown){let id=$(this).attr("id");$(this).html('<div style="unicode-bidi:embed; font-family:monospace; font-size:12px; font-weight:normal; color:black; background-color:#FFAA4D; border-left:12px solid red; padding:3px 6px 3px 6px;">'+'Plugin YetAnotherWPICALCalendar::ERROR -- Cannot get annotations! STATUS="'+status+'" ERROR="'+error_thrown+'"'+'<br />[yetanotherwpicalcalendar-annotation id="'+id+'"]'+'"</div>')}.bind(this))}})})}function annotate(id="",day=""){jQuery(function($){var _ga=globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")];modal=_ga.modals["annotation"];note="";if(id in _ga.annotations){for(var i=0;i<_ga.annotations[id].length;i++){anno=_ga.annotations[id][i];if(anno.day==day){note=anno.note;break}}}_ga.data["annotation"]={id:id,day:day,note:note};_ga.post_state["annotation"]=null;modal.open();setTimeout(function(){$("#annotation-note").focus()},100)})}function ajax_write_annotation(){var _ga=globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")];jQuery(function($){let data=_ga.data["annotation"];let obj={action:"yetanotherwpicalcalendar_add_annotation",id:data.id,day:data.day,note:data.note};_ga.post_state["annotation"]=AJAX.RUNNING;let resultInterval=setInterval(function(){if(_ga.post_state["annotation"]!=null&&_ga.post_state["annotation"]!=AJAX.RUNNING){switch(_ga.post_state["annotation"]){case 1:clearInterval(resultInterval);$("#"+this.id+"-cal-msg").html('<div style="unicode-bidi:embed; font-family:monospace; font-size:12px; font-weight:normal; color:black; background-color:#FFAA4D; border-left:12px solid red; padding:3px 6px 3px 6px;">'+'Plugin YetAnotherWPICALCalendar::ERROR -- Cannot write annotation! DAY="'+this.day+'"'+'<br />[yetanotherwpicalcalendar-annotation id="'+this.id+'"]'+'"</div>');$("#"+this.id+"-cal-msg").css("display","block");break;case 2:clearInterval(resultInterval);load_annotations("#"+this.id);break}}}.bind(data),100);$.ajax({url:"/wp-admin/admin-ajax.php",data:obj,method:"POST"}).done(function(data,status,jqXHR){var b_is_ok=false;if(status=="success"){let rc=data["status"];b_is_ok=rc=="OK"}_ga.post_state["annotation"]=AJAX.DONE}.bind(data)).fail(function(jqXHR,status,error_thrown){_ga.post_state["annotation"]=AJAX.FAIL}.bind(data))})}function delete_annotation(id,day){var _ga=globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")];_ga.data["annotation"].id=id;_ga.data["annotation"].day=day;_ga.data["annotation"].note="";ajax_write_annotation()}return{defaults:defaults,resize_timeout:resize_timeout,AJAX:AJAX,is_empty:is_empty,is_null:is_null,resize:resize,post_cb:post_cb,post:post,load_annotations:load_annotations,annotate:annotate,ajax_write_annotation:ajax_write_annotation,delete_annotation:delete_annotation}}()}addEventListener("DOMContentLoaded",event=>{(function($){var _g=globalThis[Symbol.for("yetanotherwpicalcalendar_storage")];var _ga=globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")];if(_g.defaults.is_enabled){yetanotherwpicalcalendar_annotate=_g.annotate;yetanotherwpicalcalendar_del_annotation=_g.delete_annotation;$(window).resize(function(){if(_g.resize_timeout!=null){clearTimeout(_g.resize_timeout)}_g.resize_timeout=setTimeout(_g.resize,100)});_g.resize();_g.load_annotations();_ga.modals["annotation"]=new tingle.modal({footer:true,stickyFooter:false,closeMethods:["overlay","button","escape"],closeLabel:"Close",cssClass:[],beforeOpen:function(){_ga.abort["annotation"]=false;_ga.save["annotation"]=false;$("#annotation-day").text(_ga.format_day(_ga.data["annotation"].day));$("#annotation-note").val(_ga.data["annotation"].note);$("#annotation-msg").css("display","none")},onOpen:function(){},onClose:function(){if(_ga.post_state["annotation"]==null){_ga.post_state["annotation"]=_g.AJAX.FINAL}},beforeClose:function(){if(_ga.abort["annotation"]){_ga.abort["annotation"]=false}if(_ga.save["annotation"]){_ga.save["annotation"]=false;_ga.data["annotation"].note=$("#annotation-note").val();_g.ajax_write_annotation()}return true}});_ga.data["annotation"]={};_ga.post_state["annotation"]=null;_ga.modals["annotation"].setContent('<div class="yetanotherwpicalcalendar-annotation-modal">'+'<div><strong style="border-bottom:1px dotted gray;">Notiz bearbeiten</strong></div>'+'<form action="#">'+'<div id="annotation-calendar-id" style="display:none;"></div>'+'Vom <span id="annotation-day"></span>:<br />'+'<div class="grow-wrap"><textarea id="annotation-note" onInput="this.parentNode.dataset.replicatedValue = this.value"></textarea></div>'+"</form>"+'<div id="annotation-msg" style="display:none;><div class="loader"></div></div>'+"</div>");_ga.modals["annotation"].addFooterBtn("Speichern","tingle-btn tingle-btn--primary tingle-btn--pull-right",function(){_ga=globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")];$("#annotation-msg").css("display","block");_ga.save["annotation"]=true;_ga.modals["annotation"].close()});_ga.modals["annotation"].addFooterBtn("Abbruch","tingle-btn tingle-btn--pull-right",function(){_ga=globalThis[Symbol.for("yetanotherwpicalcalendar_annotation_storage")];_ga.abort["annotation"]=true;_ga.modals["annotation"].close()})}})(jQuery)})}else{console.error("plugin:yetanotherwpicalcalendar:ERROR: jQuery is undefined!")}